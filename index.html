<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: transparent;
            margin: 0;
            overflow: hidden;
        }

        .card-wrap {
            display: inline-block;
            text-align: center;
            padding: 1rem;
        }
    </style>
</head>

<body>
    <div class="card-wrap min-w-[280px]">
        <p class="text-[10px] font-bold text-[#5c5be5] uppercase tracking-widest mb-1">Average Bed Time</p>
        <div class="flex items-center justify-center gap-3">
            <span id="bed-res" class="text-4xl font-extrabold text-slate-800 tracking-tighter">--:--</span>
            <button onclick="copyToClipboard('bed-res', this)"
                class="bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded text-slate-500 text-[10px] font-bold transition-all">
                <i class="fa-regular fa-copy"></i>
            </button>
        </div>
        <p class="text-[10px] text-slate-400 mt-1">Based on <span id="bed-cnt">0</span> days</p>
    </div>

    <script>
        function calcTime(data) {
            // Updated Regex: ignores anything after the first MM
            const entries = data.split(',').map(l => l.trim().match(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]/)?.[0]).filter(Boolean);
            if (entries.length === 0) return;
            let sinSum = 0, cosSum = 0;
            entries.forEach(time => {
                const [h, m] = time.split(':').map(Number);
                const angle = ((h * 60 + m) / 1440) * 2 * Math.PI;
                sinSum += Math.sin(angle); cosSum += Math.cos(angle);
            });
            const avgAngle = Math.atan2(sinSum, cosSum);
            let avgMins = (avgAngle * 1440) / (2 * Math.PI);
            if (avgMins < 0) avgMins += 1440;
            const finalMins = Math.round(avgMins) % 1440;
            const h = Math.floor(finalMins / 60), m = finalMins % 60;
            document.getElementById('bed-res').innerText = String(h).padStart(2, '0') + ":" + String(m).padStart(2, '0');
            document.getElementById('bed-cnt').innerText = entries.length;
        }
        function copyToClipboard(id, btn) {
            const val = document.getElementById(id).innerText;
            if (val !== "--:--") {
                navigator.clipboard.writeText(val);
                btn.innerHTML = '<i class="fa-solid fa-check text-green-500"></i>';
                setTimeout(() => { btn.innerHTML = '<i class="fa-regular fa-copy"></i>'; }, 2000);
            }
        }
        const params = new URLSearchParams(window.location.search);
        if (params.has('bedTimes')) calcTime(params.get('bedTimes'));
    </script>
</body>

</html>