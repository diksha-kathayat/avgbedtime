<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        html,
        body {
            margin: 0;
            padding: 0;
            background: transparent;
            overflow: hidden;
            height: auto;
            width: auto;
        }

        .card-container {
            display: inline-block;
            font-family: 'Inter', sans-serif;
            text-align: center;
            padding: 10px;
        }
    </style>
</head>

<body>
    <div class="card-container min-w-[250px]">
        <p class="text-[10px] font-bold text-[#5c5be5] uppercase tracking-widest mb-1">Average Bed Time</p>
        <div class="flex items-center justify-center gap-3">
            <span id="bed-res" class="text-4xl font-extrabold text-slate-800 tracking-tighter">--:--</span>
            <button onclick="copyToClipboard('bed-res', this)"
                class="bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded text-slate-500 text-[10px] font-bold">
                <i class="fa-regular fa-copy"></i>
            </button>
        </div>
        <p class="text-[10px] text-slate-400 mt-1">Based on <span id="bed-cnt">0</span> days</p>
    </div>

    <script>
        function calcTime(data) {
            // Extracts times like "23:30" from the URL string
            const entries = data.split(',').map(l => l.trim().match(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]/)?.[0]).filter(Boolean);

            if (entries.length === 0) return;

            let sinSum = 0, cosSum = 0;
            entries.forEach(time => {
                const [h, m] = time.split(':').map(Number);
                const angle = ((h * 60 + m) / 1440) * 2 * Math.PI;
                sinSum += Math.sin(angle);
                cosSum += Math.cos(angle);
            });

            const avgAngle = Math.atan2(sinSum, cosSum);
            let avgMins = (avgAngle * 1440) / (2 * Math.PI);
            if (avgMins < 0) avgMins += 1440;

            const finalMins = Math.round(avgMins) % 1440;
            let h = Math.floor(finalMins / 60);
            const m = finalMins % 60;

            // --- 12-hour Format Conversion ---
            const ampm = h >= 12 ? 'PM' : 'AM';
            let h12 = h % 12;
            h12 = h12 ? h12 : 12; // Converts 0 to 12

            const displayTime = h12 + ":" + String(m).padStart(2, '0') + " " + ampm;

            document.getElementById('bed-res').innerText = displayTime;
            document.getElementById('bed-cnt').innerText = entries.length;
        }

        function copyToClipboard(id, btn) {
            const val = document.getElementById(id).innerText;
            if (val !== "--:--") {
                navigator.clipboard.writeText(val);
                btn.innerHTML = '<i class="fa-solid fa-check text-green-500"></i>';
                setTimeout(() => { btn.innerHTML = '<i class="fa-regular fa-copy"></i>'; }, 2000);
            }
        }

        // To test this: add ?bedTimes=23:00,00:30 to the end of your URL
        const params = new URLSearchParams(window.location.search);
        if (params.has('bedTimes')) {
            calcTime(params.get('bedTimes'));
        }
    </script>
</body>

</html>